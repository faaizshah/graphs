"use strict";

require("core-js/modules/es.array.concat");

require("core-js/modules/es.string.bold");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createLogUpdate = createLogUpdate;

var _chalk = _interopRequireDefault(require("chalk"));

var _numeral = _interopRequireDefault(require("numeral"));

var _rxjs = require("rxjs");

var _format = require("./format");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

// eslint-disable-next-line import/prefer-default-export
function createLogUpdate(config, rtenv) {
  // throttle logging of scan updates
  var logUpdate$ = new _rxjs.Subject();
  var linkSaved = config.dryrun ? 'saves:' : 'saved:';
  logUpdate$.throttleTime(100) // throttle scan updates 100ms each
  .subscribe(function () {
    rtenv.log("".concat(_chalk["default"].blue('pkgs:'), " ").concat((0, _numeral["default"])(rtenv.completedPackages).format('0,0'), "/").concat((0, _numeral["default"])(rtenv.packageCount).format('0,0'), " ").concat(_chalk["default"].green(linkSaved), " ").concat(_chalk["default"].bold((0, _format.formatBytes)(rtenv.savedByteCount)), " ").concat(_chalk["default"].dim((0, _format.trunc)(config.extraCols, rtenv.currentPackageDir))));
  });
  return function logUpdate() {
    logUpdate$.next();
  };
}